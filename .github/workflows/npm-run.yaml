name: NPM RUN

on:
  workflow_call:
    inputs:
      NODE_VERSION:
        type: string
        required: false
        default: "20"
      WORKING_DIRECTORY:
        type: string
        required: false
        default: "app"
      COMMANDS:
        type: string
        required: true
        default: '["test", "lint", "prettier:check"]'

jobs:
  npm-run:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: true
      max-parallel: 5
      matrix:
        COMMANDS: ${{ fromJson(inputs.COMMANDS) }}
    defaults:
      run:
        shell: bash
        working-directory: ${{ inputs.WORKING_DIRECTORY }}
    steps:
      - name: checkout
        uses: actions/checkout@v5.0.0

      - name: setup node
        uses: actions/setup-node@v6.0.0
        with:
          node-version: ${{ inputs.NODE_VERSION }}
          cache: "npm"
          cache-dependency-path: ${{ inputs.WORKING_DIRECTORY }}/package-lock.json

      - name: npm install
        run: npm ci

      - name: run commands
        run: |
          npm run ${{ matrix.COMMANDS }}
